# Backend Audit Report

**Generated:** 2025-12-04T21:58:31.517Z
**Duration:** 5.96s
**Checks Run:** orphaned-records, import-completeness, type-sync, rpc-drift, sql-security, sql-performance, sql-correctness

## Summary

| Severity | Count |
|----------|------:|
| CRITICAL | 72 |
| HIGH | 15 |
| MEDIUM | 1 |
| LOW | 20 |
| **Total** | **108** |

## Statistics

| Metric | Value |
|--------|------:|
| Orphaned Record Issues | 0 |
| Import Completeness Issues | 1 |
| Type Sync Issues | 25 |
| Rpc Drift Issues | 46 |
| Security Issues | 8 |
| Performance Issues | 28 |
| Correctness Issues | 0 |

## CRITICAL Issues

### organizations

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00001_initial_schema.sql:3`

**Description:** Table 'organizations' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### users

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00001_initial_schema.sql:11`

**Description:** Table 'users' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### projects

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00001_initial_schema.sql:29`

**Description:** Table 'projects' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### invitations

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00002_invitations_table.sql:74`

**Description:** Table 'invitations' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### drawings

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00009_foundation_tables.sql:25`

**Description:** Table 'drawings' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### areas

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00009_foundation_tables.sql:42`

**Description:** Table 'areas' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### systems

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00009_foundation_tables.sql:54`

**Description:** Table 'systems' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### test_packages

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00009_foundation_tables.sql:66`

**Description:** Table 'test_packages' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### progress_templates

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00009_foundation_tables.sql:79`

**Description:** Table 'progress_templates' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### components

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00010_component_tracking.sql:17`

**Description:** Table 'components' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### milestone_events

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00010_component_tracking.sql:45`

**Description:** Table 'milestone_events' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### welders

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00011_welder_field_weld_qc.sql:17`

**Description:** Table 'welders' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### needs_review

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00012_exception_audit.sql:17`

**Description:** Table 'needs_review' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### audit_log

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00012_exception_audit.sql:57`

**Description:** Table 'audit_log' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### field_welds

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00033_create_field_welds.sql:25`

**Description:** Table 'field_welds' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### report_configs

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00056_create_report_configs.sql:14`

**Description:** Table 'report_configs' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### rate_limit_events

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00066_create_rate_limit_events.sql:5`

**Description:** Table 'rate_limit_events' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### field_weld_report_snapshots

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00075_field_weld_report_snapshots.sql:9`

**Description:** Table 'field_weld_report_snapshots' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### project_progress_templates

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00087_project_progress_templates.sql:8`

**Description:** Table 'project_progress_templates' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### project_template_changes

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00089_template_audit.sql:7`

**Description:** Table 'project_template_changes' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### package_certificates

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251121234718_create_package_certificates.sql:6`

**Description:** Table 'package_certificates' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### package_workflow_stages

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251121234756_create_package_workflow_stages.sql:6`

**Description:** Table 'package_workflow_stages' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### package_drawing_assignments

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251121234839_create_package_assignments.sql:6`

**Description:** Table 'package_drawing_assignments' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### package_workflow_templates

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251122184641_create_package_workflow_templates.sql:6`

**Description:** Table 'package_workflow_templates' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### demo_leads

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251125202553_create_demo_leads_table.sql:4`

**Description:** Table 'demo_leads' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### prevent_last_owner_removal.owner

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00002_invitations_table.sql:209`

**Description:** Function 'prevent_last_owner_removal' references non-existent table 'owner'

**Suggested Fix:** Review function prevent_last_owner_removal and update or remove references to 'owner'


### prevent_last_owner_removal.user_organizations

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00002_invitations_table.sql:209`

**Description:** Function 'prevent_last_owner_removal' references non-existent table 'user_organizations'

**Suggested Fix:** Review function prevent_last_owner_removal and update or remove references to 'user_organizations'


### cascade_org_soft_delete.user_organizations

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00002_invitations_table.sql:247`

**Description:** Function 'cascade_org_soft_delete' references non-existent table 'user_organizations'

**Suggested Fix:** Review function cascade_org_soft_delete and update or remove references to 'user_organizations'


### user_is_org_member.user_organizations

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00005_fix_user_organizations_recursion.sql:11`

**Description:** Function 'user_is_org_member' references non-existent table 'user_organizations'

**Suggested Fix:** Review function user_is_org_member and update or remove references to 'user_organizations'


### validate_milestone_weights.jsonb_array_elements

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00009_foundation_tables.sql:121`

**Description:** Function 'validate_milestone_weights' references non-existent table 'jsonb_array_elements'

**Suggested Fix:** Review function validate_milestone_weights and update or remove references to 'jsonb_array_elements'


### normalize_drawing_number.numeric

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00009_foundation_tables.sql:157`

**Description:** Function 'normalize_drawing_number' references non-existent table 'numeric'

**Suggested Fix:** Review function normalize_drawing_number and update or remove references to 'numeric'


### calculate_component_percent.jsonb_array_elements

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251124165954_fix_calculate_percent_for_100_scale_milestones.sql:7`

**Description:** Function 'calculate_component_percent' references non-existent table 'jsonb_array_elements'

**Suggested Fix:** Review function calculate_component_percent and update or remove references to 'jsonb_array_elements'


### update_component_percent_on_milestone_change.attributes

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00118_fix_aggregate_threaded_pipe_milestone_conversion.sql:14`

**Description:** Function 'update_component_percent_on_milestone_change' references non-existent table 'attributes'

**Suggested Fix:** Review function update_component_percent_on_milestone_change and update or remove references to 'attributes'


### update_component_percent_on_milestone_change.jsonb_each

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00118_fix_aggregate_threaded_pipe_milestone_conversion.sql:14`

**Description:** Function 'update_component_percent_on_milestone_change' references non-existent table 'jsonb_each'

**Suggested Fix:** Review function update_component_percent_on_milestone_change and update or remove references to 'jsonb_each'


### update_component_percent_on_milestone_change.absolute

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00118_fix_aggregate_threaded_pipe_milestone_conversion.sql:14`

**Description:** Function 'update_component_percent_on_milestone_change' references non-existent table 'absolute'

**Suggested Fix:** Review function update_component_percent_on_milestone_change and update or remove references to 'absolute'


### update_component_percent_on_milestone_change.NEW

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00118_fix_aggregate_threaded_pipe_milestone_conversion.sql:14`

**Description:** Function 'update_component_percent_on_milestone_change' references non-existent table 'NEW'

**Suggested Fix:** Review function update_component_percent_on_milestone_change and update or remove references to 'NEW'


### get_weld_repair_history.field_weld_inspections

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00011_welder_field_weld_qc.sql:139`

**Description:** Function 'get_weld_repair_history' references non-existent table 'field_weld_inspections'

**Suggested Fix:** Review function get_weld_repair_history and update or remove references to 'field_weld_inspections'


### get_weld_repair_history.repair_chain

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00011_welder_field_weld_qc.sql:139`

**Description:** Function 'get_weld_repair_history' references non-existent table 'repair_chain'

**Suggested Fix:** Review function get_weld_repair_history and update or remove references to 'repair_chain'


### update_component_milestone.jsonb_array_elements

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251122152612_fix_discrete_milestone_value_scale.sql:108`

**Description:** Function 'update_component_milestone' references non-existent table 'jsonb_array_elements'

**Suggested Fix:** Review function update_component_milestone and update or remove references to 'jsonb_array_elements'


### update_component_milestone.milestones

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251122152612_fix_discrete_milestone_value_scale.sql:108`

**Description:** Function 'update_component_milestone' references non-existent table 'milestones'

**Suggested Fix:** Review function update_component_milestone and update or remove references to 'milestones'


### update_component_milestone.component

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251122152612_fix_discrete_milestone_value_scale.sql:108`

**Description:** Function 'update_component_milestone' references non-existent table 'component'

**Suggested Fix:** Review function update_component_milestone and update or remove references to 'component'


### assign_drawing_with_inheritance.drawing

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00027_fix_single_drawing_no_change.sql:23`

**Description:** Function 'assign_drawing_with_inheritance' references non-existent table 'drawing'

**Suggested Fix:** Review function assign_drawing_with_inheritance and update or remove references to 'drawing'


### assign_drawing_with_inheritance.for

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00027_fix_single_drawing_no_change.sql:23`

**Description:** Function 'assign_drawing_with_inheritance' references non-existent table 'for'

**Suggested Fix:** Review function assign_drawing_with_inheritance and update or remove references to 'for'


### assign_drawing_with_inheritance.NULL

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00027_fix_single_drawing_no_change.sql:23`

**Description:** Function 'assign_drawing_with_inheritance' references non-existent table 'NULL'

**Suggested Fix:** Review function assign_drawing_with_inheritance and update or remove references to 'NULL'


### assign_drawings_bulk.current_values

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00029_fix_bulk_assignment_text_params.sql:12`

**Description:** Function 'assign_drawings_bulk' references non-existent table 'current_values'

**Suggested Fix:** Review function assign_drawings_bulk and update or remove references to 'current_values'


### update_test_package.statement

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00028_fix_package_readiness_inheritance.sql:88`

**Description:** Function 'update_test_package' references non-existent table 'statement'

**Suggested Fix:** Review function update_test_package and update or remove references to 'statement'


### update_test_package.v_update_query

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00028_fix_package_readiness_inheritance.sql:88`

**Description:** Function 'update_test_package' references non-existent table 'v_update_query'

**Suggested Fix:** Review function update_test_package and update or remove references to 'v_update_query'


### handle_weld_rejection.array

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00072_fix_trigger_array_handling.sql:6`

**Description:** Function 'handle_weld_rejection' references non-existent table 'array'

**Suggested Fix:** Review function handle_weld_rejection and update or remove references to 'array'


### handle_weld_rejection.jsonb_array_elements

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00072_fix_trigger_array_handling.sql:6`

**Description:** Function 'handle_weld_rejection' references non-existent table 'jsonb_array_elements'

**Suggested Fix:** Review function handle_weld_rejection and update or remove references to 'jsonb_array_elements'


### accept_invitation_for_user.auth

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00049_accept_invitation_function.sql:6`

**Description:** Function 'accept_invitation_for_user' references non-existent table 'auth'

**Suggested Fix:** Review function accept_invitation_for_user and update or remove references to 'auth'


### accept_invitation_for_user.user

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00049_accept_invitation_function.sql:6`

**Description:** Function 'accept_invitation_for_user' references non-existent table 'user'

**Suggested Fix:** Review function accept_invitation_for_user and update or remove references to 'user'


### increment_component_version.NEW

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00063_add_components_version_field.sql:11`

**Description:** Function 'increment_component_version' references non-existent table 'NEW'

**Suggested Fix:** Review function increment_component_version and update or remove references to 'NEW'


### increment_component_version.last_updated_at

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00063_add_components_version_field.sql:11`

**Description:** Function 'increment_component_version' references non-existent table 'last_updated_at'

**Suggested Fix:** Review function increment_component_version and update or remove references to 'last_updated_at'


### create_field_weld_snapshot.vw_field_weld_progress_by_area

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251120194920_add_field_weld_count_columns.sql:554`

**Description:** Function 'create_field_weld_snapshot' references non-existent table 'vw_field_weld_progress_by_area'

**Suggested Fix:** Review function create_field_weld_snapshot and update or remove references to 'vw_field_weld_progress_by_area'


### create_field_weld_snapshot.vw_field_weld_progress_by_system

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251120194920_add_field_weld_count_columns.sql:554`

**Description:** Function 'create_field_weld_snapshot' references non-existent table 'vw_field_weld_progress_by_system'

**Suggested Fix:** Review function create_field_weld_snapshot and update or remove references to 'vw_field_weld_progress_by_system'


### create_field_weld_snapshot.vw_field_weld_progress_by_test_package

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251120194920_add_field_weld_count_columns.sql:554`

**Description:** Function 'create_field_weld_snapshot' references non-existent table 'vw_field_weld_progress_by_test_package'

**Suggested Fix:** Review function create_field_weld_snapshot and update or remove references to 'vw_field_weld_progress_by_test_package'


### create_field_weld_snapshot.this

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251120194920_add_field_weld_count_columns.sql:554`

**Description:** Function 'create_field_weld_snapshot' references non-existent table 'this'

**Suggested Fix:** Review function create_field_weld_snapshot and update or remove references to 'this'


### create_field_weld_snapshot.vw_field_weld_progress_by_welder

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251120194920_add_field_weld_count_columns.sql:554`

**Description:** Function 'create_field_weld_snapshot' references non-existent table 'vw_field_weld_progress_by_welder'

**Suggested Fix:** Review function create_field_weld_snapshot and update or remove references to 'vw_field_weld_progress_by_welder'


### convert_milestone_booleans_to_numeric.jsonb_each

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00084_convert_boolean_milestones_to_numeric.sql:17`

**Description:** Function 'convert_milestone_booleans_to_numeric' references non-existent table 'jsonb_each'

**Suggested Fix:** Review function convert_milestone_booleans_to_numeric and update or remove references to 'jsonb_each'


### convert_milestone_booleans_to_numeric.the

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00084_convert_boolean_milestones_to_numeric.sql:17`

**Description:** Function 'convert_milestone_booleans_to_numeric' references non-existent table 'the'

**Suggested Fix:** Review function convert_milestone_booleans_to_numeric and update or remove references to 'the'


### validate_project_template_weights.ON

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00088_template_validation.sql:7`

**Description:** Function 'validate_project_template_weights' references non-existent table 'ON'

**Suggested Fix:** Review function validate_project_template_weights and update or remove references to 'ON'


### update_project_template_weights.jsonb_array_elements

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00111_add_rpc_input_validation.sql:6`

**Description:** Function 'update_project_template_weights' references non-existent table 'jsonb_array_elements'

**Suggested Fix:** Review function update_project_template_weights and update or remove references to 'jsonb_array_elements'


### update_project_template_weights.template

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00111_add_rpc_input_validation.sql:6`

**Description:** Function 'update_project_template_weights' references non-existent table 'template'

**Suggested Fix:** Review function update_project_template_weights and update or remove references to 'template'


### get_project_template_summary.system

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00096_template_summary_rpc.sql:7`

**Description:** Function 'get_project_template_summary' references non-existent table 'system'

**Suggested Fix:** Review function get_project_template_summary and update or remove references to 'system'


### upsert_aggregate_threaded_pipe.reading

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00119_atomic_aggregate_threaded_pipe_upsert.sql:14`

**Description:** Function 'upsert_aggregate_threaded_pipe' references non-existent table 'reading'

**Suggested Fix:** Review function upsert_aggregate_threaded_pipe and update or remove references to 'reading'


### upsert_aggregate_threaded_pipe.modifying

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00119_atomic_aggregate_threaded_pipe_upsert.sql:14`

**Description:** Function 'upsert_aggregate_threaded_pipe' references non-existent table 'modifying'

**Suggested Fix:** Review function upsert_aggregate_threaded_pipe and update or remove references to 'modifying'


### upsert_aggregate_threaded_pipe.it

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00119_atomic_aggregate_threaded_pipe_upsert.sql:14`

**Description:** Function 'upsert_aggregate_threaded_pipe' references non-existent table 'it'

**Suggested Fix:** Review function upsert_aggregate_threaded_pipe and update or remove references to 'it'


### upsert_aggregate_threaded_pipe.the

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00119_atomic_aggregate_threaded_pipe_upsert.sql:14`

**Description:** Function 'upsert_aggregate_threaded_pipe' references non-existent table 'the'

**Suggested Fix:** Review function upsert_aggregate_threaded_pipe and update or remove references to 'the'


### create_unplanned_weld.auth

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251124145806_fix_create_unplanned_weld_role_names.sql:16`

**Description:** Function 'create_unplanned_weld' references non-existent table 'auth'

**Suggested Fix:** Review function create_unplanned_weld and update or remove references to 'auth'


### notify_qc_on_weld_completion.NULL

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251120213000_add_trigger_component_validation.sql:10`

**Description:** Function 'notify_qc_on_weld_completion' references non-existent table 'NULL'

**Suggested Fix:** Review function notify_qc_on_weld_completion and update or remove references to 'NULL'


### notify_qc_on_weld_completion.field

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251120213000_add_trigger_component_validation.sql:10`

**Description:** Function 'notify_qc_on_weld_completion' references non-existent table 'field'

**Suggested Fix:** Review function notify_qc_on_weld_completion and update or remove references to 'field'


### invitations

- **Type:** `missing_rls`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00002_invitations_table.sql:74`

**Description:** Table 'invitations' does not have Row Level Security enabled

**Suggested Fix:** Add migration: ALTER TABLE invitations ENABLE ROW LEVEL SECURITY;


## HIGH Issues

### get_user_org_role

- **Type:** `security_definer`
- **Severity:** HIGH
- **Count:** 1
- **Location:** `00038_fix_get_user_org_role.sql:14`

**Description:** SECURITY DEFINER function 'get_user_org_role' may lack permission check

**Suggested Fix:** Add permission check using auth.uid() at the start of function body


### user_is_org_member

- **Type:** `security_definer`
- **Severity:** HIGH
- **Count:** 1
- **Location:** `00005_fix_user_organizations_recursion.sql:11`

**Description:** SECURITY DEFINER function 'user_is_org_member' may lack permission check

**Suggested Fix:** Add permission check using auth.uid() at the start of function body


### check_email_has_organization

- **Type:** `security_definer`
- **Severity:** HIGH
- **Count:** 1
- **Location:** `00041_fix_users_rls_final.sql:12`

**Description:** SECURITY DEFINER function 'check_email_has_organization' may lack permission check

**Suggested Fix:** Add permission check using auth.uid() at the start of function body


### auto_clone_templates_on_project_create

- **Type:** `security_definer`
- **Severity:** HIGH
- **Count:** 1
- **Location:** `00099_fix_auto_clone_trigger.sql:2`

**Description:** SECURITY DEFINER function 'auto_clone_templates_on_project_create' may lack permission check

**Suggested Fix:** Add permission check using auth.uid() at the start of function body


### recalculate_components_with_template

- **Type:** `security_definer`
- **Severity:** HIGH
- **Count:** 1
- **Location:** `00111_add_rpc_input_validation.sql:167`

**Description:** SECURITY DEFINER function 'recalculate_components_with_template' may lack permission check

**Suggested Fix:** Add permission check using auth.uid() at the start of function body


### refresh_package_readiness_on_component_change

- **Type:** `security_definer`
- **Severity:** HIGH
- **Count:** 1
- **Location:** `00112_auto_refresh_package_readiness_mv.sql:12`

**Description:** SECURITY DEFINER function 'refresh_package_readiness_on_component_change' may lack permission check

**Suggested Fix:** Add permission check using auth.uid() at the start of function body


### upsert_aggregate_threaded_pipe

- **Type:** `security_definer`
- **Severity:** HIGH
- **Count:** 1
- **Location:** `00119_atomic_aggregate_threaded_pipe_upsert.sql:14`

**Description:** SECURITY DEFINER function 'upsert_aggregate_threaded_pipe' may lack permission check

**Suggested Fix:** Add permission check using auth.uid() at the start of function body


### components.created_by

- **Type:** `missing_index`
- **Severity:** HIGH
- **Count:** 1
- **References:** users

**Description:** Foreign key column 'components.created_by' lacks an index

**Suggested Fix:** CREATE INDEX idx_components_created_by ON components(created_by);


### components.last_updated_by

- **Type:** `missing_index`
- **Severity:** HIGH
- **Count:** 1
- **References:** users

**Description:** Foreign key column 'components.last_updated_by' lacks an index

**Suggested Fix:** CREATE INDEX idx_components_last_updated_by ON components(last_updated_by);


### welders.created_by

- **Type:** `missing_index`
- **Severity:** HIGH
- **Count:** 1
- **References:** users

**Description:** Foreign key column 'welders.created_by' lacks an index

**Suggested Fix:** CREATE INDEX idx_welders_created_by ON welders(created_by);


### welders.verified_by

- **Type:** `missing_index`
- **Severity:** HIGH
- **Count:** 1
- **References:** users

**Description:** Foreign key column 'welders.verified_by' lacks an index

**Suggested Fix:** CREATE INDEX idx_welders_verified_by ON welders(verified_by);


### field_welds.created_by

- **Type:** `missing_index`
- **Severity:** HIGH
- **Count:** 1
- **References:** users

**Description:** Foreign key column 'field_welds.created_by' lacks an index

**Suggested Fix:** CREATE INDEX idx_field_welds_created_by ON field_welds(created_by);


### needs_review.created_by

- **Type:** `missing_index`
- **Severity:** HIGH
- **Count:** 1
- **References:** users

**Description:** Foreign key column 'needs_review.created_by' lacks an index

**Suggested Fix:** CREATE INDEX idx_needs_review_created_by ON needs_review(created_by);


### needs_review.resolved_by

- **Type:** `missing_index`
- **Severity:** HIGH
- **Count:** 1
- **References:** users

**Description:** Foreign key column 'needs_review.resolved_by' lacks an index

**Suggested Fix:** CREATE INDEX idx_needs_review_resolved_by ON needs_review(resolved_by);


### package_workflow_stages.completed_by

- **Type:** `missing_index`
- **Severity:** HIGH
- **Count:** 1
- **References:** users

**Description:** Foreign key column 'package_workflow_stages.completed_by' lacks an index

**Suggested Fix:** CREATE INDEX idx_package_workflow_stages_completed_by ON package_workflow_stages(completed_by);


## MEDIUM Issues

### test_packages.test_type

- **Type:** `null_required`
- **Severity:** MEDIUM
- **Count:** 5

**Description:** test_packages.test_type is NULL in 5 row(s)

**Suggested Fix:** -- Review import logic to ensure test_type is populated:
-- SELECT id, created_at FROM test_packages WHERE test_type IS NULL LIMIT 10;

<details>
<summary>Sample Records (5)</summary>

```json
[
  {
    "id": "be808770-fdb7-4218-bb4e-3ef227a4fa41",
    "created_at": "2025-10-21T22:03:51.705876+00:00"
  },
  {
    "id": "7cdf006a-9a4f-4a6e-b812-88bf5c1335c5",
    "created_at": "2025-10-21T21:44:47.851013+00:00"
  },
  {
    "id": "221e651d-a3ed-4dbf-9fc5-76ed6842c8a6",
    "created_at": "2025-10-22T13:06:45.106758+00:00"
  },
  {
    "id": "ae73e142-d260-4854-8120-413b391b7cca",
    "created_at": "2025-10-22T13:06:49.599003+00:00"
  },
  {
    "id": "04ba8436-90e4-4423-9a30-871831ab263e",
    "created_at": "2025-10-22T13:06:54.53477+00:00"
  }
]
```
</details>


## LOW Issues

### 00009_foundation_tables.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00009_foundation_tables.sql:127`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00010_component_tracking.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00010_component_tracking.sql:203`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00018_add_update_component_milestone_rpc.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00018_add_update_component_milestone_rpc.sql:75`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00020_fix_percent_complete_trigger.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00020_fix_percent_complete_trigger.sql:48`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00084_convert_boolean_milestones_to_numeric.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00084_convert_boolean_milestones_to_numeric.sql:42`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00084_convert_boolean_milestones_to_numeric.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00084_convert_boolean_milestones_to_numeric.sql:103`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00092_update_calculate_percent.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00092_update_calculate_percent.sql:75`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00094_update_template_weights_rpc.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00094_update_template_weights_rpc.sql:102`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00100_debug_template_weights_rpc.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00100_debug_template_weights_rpc.sql:87`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00101_debug_log_table.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00101_debug_log_table.sql:96`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00102_force_update_debug_function.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00102_force_update_debug_function.sql:89`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00103_temp_skip_validation.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00103_temp_skip_validation.sql:88`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00104_remove_optimistic_lock.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00104_remove_optimistic_lock.sql:76`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00105_debug_rpc_final.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00105_debug_rpc_final.sql:52`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00107_restore_production_rpc.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00107_restore_production_rpc.sql:120`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00111_add_rpc_input_validation.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00111_add_rpc_input_validation.sql:118`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00113_threaded_pipe_aggregate_model.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00113_threaded_pipe_aggregate_model.sql:109`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00118_fix_aggregate_threaded_pipe_milestone_conversion.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00118_fix_aggregate_threaded_pipe_milestone_conversion.sql:60`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 20251122152612_fix_discrete_milestone_value_scale.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/20251122152612_fix_discrete_milestone_value_scale.sql:172`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 20251124165954_fix_calculate_percent_for_100_scale_milestones.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/20251124165954_fix_calculate_percent_for_100_scale_milestones.sql:75`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


