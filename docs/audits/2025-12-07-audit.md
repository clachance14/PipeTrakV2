# Backend Audit Report

**Generated:** 2025-12-07T00:47:30.691Z
**Duration:** 6.48s
**Checks Run:** orphaned-records, import-completeness, type-sync, rpc-drift, sql-security, sql-performance, sql-correctness

## Summary

| Severity | Count |
|----------|------:|
| CRITICAL | 21 |
| HIGH | 3 |
| MEDIUM | 1 |
| LOW | 25 |
| **Total** | **50** |

## Statistics

| Metric | Value |
|--------|------:|
| Orphaned Record Issues | 0 |
| Import Completeness Issues | 1 |
| Type Sync Issues | 5 |
| Rpc Drift Issues | 18 |
| Security Issues | 1 |
| Performance Issues | 25 |
| Correctness Issues | 0 |

## CRITICAL Issues

### vw_manhour_progress_by_drawing

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206144303_fix_manhour_views_use_project_templates.sql:208`

**Description:** Table 'vw_manhour_progress_by_drawing' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### mv_template_milestone_weights

- **Type:** `type_mismatch`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206171736_fix_manhour_views_performance_v2.sql:17`

**Description:** Table 'mv_template_milestone_weights' exists in migrations but missing from database.types.ts

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### calculate_component_percent.get_component_template

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206155355_unified_progress_functions.sql:90`

**Description:** Function 'calculate_component_percent' references non-existent table 'get_component_template'

**Suggested Fix:** Review function calculate_component_percent and update or remove references to 'get_component_template'


### calculate_earned_milestone_value.get_component_template

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206160030_earned_manhour_functions.sql:6`

**Description:** Function 'calculate_earned_milestone_value' references non-existent table 'get_component_template'

**Suggested Fix:** Review function calculate_earned_milestone_value and update or remove references to 'get_component_template'


### create_manhour_budget.identity_key

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251205012028_add_identity_to_budget_warnings.sql:6`

**Description:** Function 'create_manhour_budget' references non-existent table 'identity_key'

**Suggested Fix:** Review function create_manhour_budget and update or remove references to 'identity_key'


### create_manhour_budget.temp_drawing_sizes

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251205012028_add_identity_to_budget_warnings.sql:6`

**Description:** Function 'create_manhour_budget' references non-existent table 'temp_drawing_sizes'

**Suggested Fix:** Review function create_manhour_budget and update or remove references to 'temp_drawing_sizes'


### create_manhour_budget.temp_component_weights

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251205012028_add_identity_to_budget_warnings.sql:6`

**Description:** Function 'create_manhour_budget' references non-existent table 'temp_component_weights'

**Suggested Fix:** Review function create_manhour_budget and update or remove references to 'temp_component_weights'


### get_progress_delta_by_dimension.get_component_template

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206181102_fix_delta_rpc_budget_calculation.sql:9`

**Description:** Function 'get_progress_delta_by_dimension' references non-existent table 'get_component_template'

**Suggested Fix:** Review function get_progress_delta_by_dimension and update or remove references to 'get_component_template'


### get_progress_delta_by_dimension.delta_aggregation

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206181102_fix_delta_rpc_budget_calculation.sql:9`

**Description:** Function 'get_progress_delta_by_dimension' references non-existent table 'delta_aggregation'

**Suggested Fix:** Review function get_progress_delta_by_dimension and update or remove references to 'delta_aggregation'


### get_progress_delta_by_dimension.LATERAL

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206181102_fix_delta_rpc_budget_calculation.sql:9`

**Description:** Function 'get_progress_delta_by_dimension' references non-existent table 'LATERAL'

**Suggested Fix:** Review function get_progress_delta_by_dimension and update or remove references to 'LATERAL'


### get_progress_delta_by_dimension.total_budget_by_dim

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206181102_fix_delta_rpc_budget_calculation.sql:9`

**Description:** Function 'get_progress_delta_by_dimension' references non-existent table 'total_budget_by_dim'

**Suggested Fix:** Review function get_progress_delta_by_dimension and update or remove references to 'total_budget_by_dim'


### get_progress_delta_by_dimension.category_budget_by_dim

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206181102_fix_delta_rpc_budget_calculation.sql:9`

**Description:** Function 'get_progress_delta_by_dimension' references non-existent table 'category_budget_by_dim'

**Suggested Fix:** Review function get_progress_delta_by_dimension and update or remove references to 'category_budget_by_dim'


### get_field_weld_delta_by_dimension.event_data

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206180027_simplify_field_weld_delta_rpc.sql:18`

**Description:** Function 'get_field_weld_delta_by_dimension' references non-existent table 'event_data'

**Suggested Fix:** Review function get_field_weld_delta_by_dimension and update or remove references to 'event_data'


### get_field_weld_delta_by_dimension.completions

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206180027_simplify_field_weld_delta_rpc.sql:18`

**Description:** Function 'get_field_weld_delta_by_dimension' references non-existent table 'completions'

**Suggested Fix:** Review function get_field_weld_delta_by_dimension and update or remove references to 'completions'


### get_field_weld_delta_by_dimension.dimension_mapping

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206180027_simplify_field_weld_delta_rpc.sql:18`

**Description:** Function 'get_field_weld_delta_by_dimension' references non-existent table 'dimension_mapping'

**Suggested Fix:** Review function get_field_weld_delta_by_dimension and update or remove references to 'dimension_mapping'


### get_field_weld_delta_by_dimension.aggregated

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206180027_simplify_field_weld_delta_rpc.sql:18`

**Description:** Function 'get_field_weld_delta_by_dimension' references non-existent table 'aggregated'

**Suggested Fix:** Review function get_field_weld_delta_by_dimension and update or remove references to 'aggregated'


### get_field_weld_delta_by_dimension.total_budget

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206180027_simplify_field_weld_delta_rpc.sql:18`

**Description:** Function 'get_field_weld_delta_by_dimension' references non-existent table 'total_budget'

**Suggested Fix:** Review function get_field_weld_delta_by_dimension and update or remove references to 'total_budget'


### calculate_category_earned_mh.get_component_template

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206160030_earned_manhour_functions.sql:65`

**Description:** Function 'calculate_category_earned_mh' references non-existent table 'get_component_template'

**Suggested Fix:** Review function calculate_category_earned_mh and update or remove references to 'get_component_template'


### verify_category_mh_sum.calculate_category_earned_mh

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206160030_earned_manhour_functions.sql:110`

**Description:** Function 'verify_category_mh_sum' references non-existent table 'calculate_category_earned_mh'

**Suggested Fix:** Review function verify_category_mh_sum and update or remove references to 'calculate_category_earned_mh'


### get_component_category_earned.get_component_template

- **Type:** `rpc_drift`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `20251206171403_fix_manhour_views_use_actual_category_calc.sql:19`

**Description:** Function 'get_component_category_earned' references non-existent table 'get_component_template'

**Suggested Fix:** Review function get_component_category_earned and update or remove references to 'get_component_template'


### invitations

- **Type:** `missing_rls`
- **Severity:** CRITICAL
- **Count:** 1
- **Location:** `00002_invitations_table.sql:74`

**Description:** Table 'invitations' does not have Row Level Security enabled

**Suggested Fix:** Add migration: ALTER TABLE invitations ENABLE ROW LEVEL SECURITY;


## HIGH Issues

### database.types.ts

- **Type:** `type_stale`
- **Severity:** HIGH
- **Count:** 1
- **Location:** `20251207001640_add_metadata_param_to_update_milestone_rpc.sql:1`

**Description:** Types file is 0 day(s) older than newest migration (20251207001640_add_metadata_param_to_update_milestone_rpc.sql)

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### milestone_events.delta_mh

- **Type:** `type_mismatch`
- **Severity:** HIGH
- **Count:** 1
- **Location:** `00010_component_tracking.sql:45`

**Description:** Column 'milestone_events.delta_mh' (NUMERIC) exists in migrations but missing from types

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


### milestone_events.category

- **Type:** `type_mismatch`
- **Severity:** HIGH
- **Count:** 1
- **Location:** `00010_component_tracking.sql:45`

**Description:** Column 'milestone_events.category' (TEXT) exists in migrations but missing from types

**Suggested Fix:** Run: supabase gen types typescript --linked > src/types/database.types.ts


## MEDIUM Issues

### test_packages.test_type

- **Type:** `null_required`
- **Severity:** MEDIUM
- **Count:** 5

**Description:** test_packages.test_type is NULL in 5 row(s)

**Suggested Fix:** -- Review import logic to ensure test_type is populated:
-- SELECT id, created_at FROM test_packages WHERE test_type IS NULL LIMIT 10;

<details>
<summary>Sample Records (5)</summary>

```json
[
  {
    "id": "be808770-fdb7-4218-bb4e-3ef227a4fa41",
    "created_at": "2025-10-21T22:03:51.705876+00:00"
  },
  {
    "id": "7cdf006a-9a4f-4a6e-b812-88bf5c1335c5",
    "created_at": "2025-10-21T21:44:47.851013+00:00"
  },
  {
    "id": "221e651d-a3ed-4dbf-9fc5-76ed6842c8a6",
    "created_at": "2025-10-22T13:06:45.106758+00:00"
  },
  {
    "id": "ae73e142-d260-4854-8120-413b391b7cca",
    "created_at": "2025-10-22T13:06:49.599003+00:00"
  },
  {
    "id": "04ba8436-90e4-4423-9a30-871831ab263e",
    "created_at": "2025-10-22T13:06:54.53477+00:00"
  }
]
```
</details>


## LOW Issues

### 00009_foundation_tables.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00009_foundation_tables.sql:127`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00010_component_tracking.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00010_component_tracking.sql:203`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00018_add_update_component_milestone_rpc.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00018_add_update_component_milestone_rpc.sql:75`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00020_fix_percent_complete_trigger.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00020_fix_percent_complete_trigger.sql:48`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00084_convert_boolean_milestones_to_numeric.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00084_convert_boolean_milestones_to_numeric.sql:42`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00084_convert_boolean_milestones_to_numeric.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00084_convert_boolean_milestones_to_numeric.sql:103`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00092_update_calculate_percent.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00092_update_calculate_percent.sql:75`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00094_update_template_weights_rpc.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00094_update_template_weights_rpc.sql:102`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00100_debug_template_weights_rpc.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00100_debug_template_weights_rpc.sql:87`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00101_debug_log_table.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00101_debug_log_table.sql:96`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00102_force_update_debug_function.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00102_force_update_debug_function.sql:89`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00103_temp_skip_validation.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00103_temp_skip_validation.sql:88`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00104_remove_optimistic_lock.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00104_remove_optimistic_lock.sql:76`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00105_debug_rpc_final.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00105_debug_rpc_final.sql:52`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00107_restore_production_rpc.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00107_restore_production_rpc.sql:120`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00111_add_rpc_input_validation.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00111_add_rpc_input_validation.sql:118`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00113_threaded_pipe_aggregate_model.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00113_threaded_pipe_aggregate_model.sql:109`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 00118_fix_aggregate_threaded_pipe_milestone_conversion.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/00118_fix_aggregate_threaded_pipe_milestone_conversion.sql:60`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 20251122152612_fix_discrete_milestone_value_scale.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/20251122152612_fix_discrete_milestone_value_scale.sql:172`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 20251124165954_fix_calculate_percent_for_100_scale_milestones.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/20251124165954_fix_calculate_percent_for_100_scale_milestones.sql:75`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 20251206155355_unified_progress_functions.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/20251206155355_unified_progress_functions.sql:100`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 20251206160030_earned_manhour_functions.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/20251206160030_earned_manhour_functions.sql:19`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 20251206171736_fix_manhour_views_performance_v2.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/20251206171736_fix_manhour_views_performance_v2.sql:45`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 20251206180019_update_milestone_rpc_with_delta_mh.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/20251206180019_update_milestone_rpc_with_delta_mh.sql:92`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


### 20251207001640_add_metadata_param_to_update_milestone_rpc.sql

- **Type:** `performance_pattern`
- **Severity:** LOW
- **Count:** 1
- **Location:** `supabase/migrations/20251207001640_add_metadata_param_to_update_milestone_rpc.sql:95`

**Description:** SELECT * usage: SELECT * may fetch unnecessary columns

**Suggested Fix:** Explicitly list required columns


